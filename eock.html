<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OBS Dual Counter Dock</title>

<style>
:root {
    --bg: #1f1f1f;
    --panel: #2b2b2b;
    --border: #3c3c3c;
    --text: #ffffff;
    --accent: #00aaff;
    --success: #4caf50;
    --danger: #ff5555;
}

* {
    box-sizing: border-box;
    font-family: Segoe UI, Roboto, Arial, sans-serif;
}

body {
    margin: 0;
    padding: 10px;
    background: var(--bg);
    color: var(--text);
}

h2 {
    font-size: 15px;
    margin-bottom: 8px;
}

.panel {
    background: var(--panel);
    border: 1px solid var(--border);
    padding: 10px;
    margin-bottom: 8px;
}

.controls {
    display: none;
}

.counter-title {
    font-size: 12px;
    opacity: 0.8;
    margin-bottom: 6px;
}

.buttons {
    display: flex;
    gap: 6px;
}

button {
    flex: 1;
    padding: 8px;
    background: #3a3a3a;
    border: 1px solid var(--border);
    color: white;
    cursor: pointer;
    font-size: 14px;
}

button:hover {
    background: #4a4a4a;
}

.inc { background: #2e7d32; }
.dec { background: #c62828; }
.reset { background: #6d6d6d; }

.toggle {
    background: var(--accent);
    border: none;
}

.status {
    font-size: 12px;
    margin-top: 6px;
}

.connected { color: var(--success); }
.disconnected { color: var(--danger); }

label {
    font-size: 11px;
    opacity: 0.8;
}

input {
    width: 100%;
    padding: 6px;
    margin-bottom: 6px;
    background: #111;
    color: white;
    border: 1px solid var(--border);
}
</style>
</head>

<body>

<h2>Dual Counter</h2>

<!-- CONTROL PANEL -->
<div id="controls" class="controls">

    <div class="panel">
        <div class="counter-title">Counter A</div>
        <div class="buttons">
            <button class="inc" onclick="hotkey('counter1_inc')">âž•</button>
            <button class="dec" onclick="hotkey('counter1_dec')">âž–</button>
            <button class="reset" onclick="hotkey('counter1_reset')">ðŸ”„</button>
        </div>
    </div>

    <div class="panel">
        <div class="counter-title">Counter B</div>
        <div class="buttons">
            <button class="inc" onclick="hotkey('counter2_inc')">âž•</button>
            <button class="dec" onclick="hotkey('counter2_dec')">âž–</button>
            <button class="reset" onclick="hotkey('counter2_reset')">ðŸ”„</button>
        </div>
    </div>
</div>

<button class="toggle" onclick="toggleConnection()">âš™ Connection</button>

<!-- CONNECTION PANEL -->
<div id="connectionPanel" class="panel">
    <label>Server IP</label>
    <input id="ip" placeholder="localhost">

    <label>Server Port</label>
    <input id="port" placeholder="4455">

    <label>Password</label>
    <input id="password" type="password">

    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>

    <div id="status" class="status disconnected">Disconnected</div>
</div>

<script>
let socket;
let identified = false;
const STORE = "obsDualCounter";

// Restore saved connection info
(function () {
    const s = JSON.parse(localStorage.getItem(STORE) || "{}");
    ip.value = s.ip || "localhost";
    port.value = s.port || "4455";
    password.value = s.password || "";
})();

function save() {
    localStorage.setItem(STORE, JSON.stringify({
        ip: ip.value,
        port: port.value,
        password: password.value
    }));
}

function toggleConnection() {
    const panel = connectionPanel;
    panel.style.display = panel.style.display === "none" ? "block" : "none";
}

async function connect() {
    save();
    socket = new WebSocket(`ws://${ip.value}:${port.value}`);

    socket.onmessage = async e => {
        const m = JSON.parse(e.data);

        if (m.op === 0) {
            let auth = {};
            if (m.d.authentication) {
                const s = await crypto.subtle.digest(
                    "SHA-256",
                    new TextEncoder().encode(password.value + m.d.authentication.salt)
                );
                const sb = btoa(String.fromCharCode(...new Uint8Array(s)));
                const r = await crypto.subtle.digest(
                    "SHA-256",
                    new TextEncoder().encode(sb + m.d.authentication.challenge)
                );
                auth.authentication = btoa(
                    String.fromCharCode(...new Uint8Array(r))
                );
            }
            socket.send(JSON.stringify({ op: 1, d: { rpcVersion: 1, ...auth } }));
        }

        if (m.op === 2) {
            identified = true;
            status.textContent = "Connected";
            status.className = "status connected";

            connectionPanel.style.display = "none";
            controls.style.display = "block";
        }
    };

    socket.onclose = () => {
        identified = false;
        status.textContent = "Disconnected";
        status.className = "status disconnected";
        controls.style.display = "none";
    };
}

function disconnect() {
    socket?.close();
}

function hotkey(name) {
    if (!identified) return;
    socket.send(JSON.stringify({
        op: 6,
        d: {
            requestType: "TriggerHotkeyByName",
            requestId: crypto.randomUUID(),
            requestData: { hotkeyName: name }
        }
    }));
}
</script>

</body>
</html>
